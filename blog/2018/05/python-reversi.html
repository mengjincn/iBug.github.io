<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="UTF-8">
    <!-- _layout: post -->
    <!-- Begin Jekyll SEO tag v2.4.0 -->
    <title>Making a Reversi game with Python | iBug @ GitHub</title>
    <meta name="generator" content="Jekyll v3.7.3" />
    <meta property="og:title" content="Making a Reversi game with Python" />
    <meta name="author" content="iBug" />
    <meta property="og:locale" content="en_US" />
    <meta name="description" content="The small personal site for iBug" />
    <meta property="og:description" content="The small personal site for iBug" />
    <link rel="canonical" href="https://ibug.github.io/blog/2018/05/python-reversi.html" />
    <meta property="og:url" content="https://ibug.github.io/blog/2018/05/python-reversi.html" />
    <meta property="og:site_name" content="iBug @ GitHub" />
    <meta property="og:type" content="article" />
    <meta property="article:published_time" content="2018-05-10T00:00:00+00:00" />
    <script type="application/ld+json">
      {"description":"The small personal site for iBug","author":{"@type":"Person","name":"iBug"},"@type":"BlogPosting","url":"https://ibug.github.io/blog/2018/05/python-reversi.html","headline":"Making a Reversi game with Python","dateModified":"2018-05-10T00:00:00+00:00","datePublished":"2018-05-10T00:00:00+00:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://ibug.github.io/blog/2018/05/python-reversi.html"},"@context":"http://schema.org"}
    </script>
    <!-- End Jekyll SEO tag -->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#159A34">
    <!-- https://fonts.googleapis.com/css?family=Open+Sans:400,700 -->
    <link href='/assets/css/OpenSans.css' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="/assets/css/style.css?v=9479e925e50f8cce924f7819a939c8c1698af9b2">
    <link rel="shortcut icon" type="image/png" href="/assets/favicon.png">
    <script type="text/javascript" src="/assets/js/love.js" ></script>
  </head>
  <body>
    <section class="page-header">
      <div class="page-header-nav">
        <span style="float:left;height:0px;">
          <a href="/blog/2018/04/build-github-pages-with-travis-ci.html" class="btn-inline">&laquo; Previous</a>
        </span>
        <span style="float:right;height:0px;">
          <!-- <a class="btn-inline disabled">Next &raquo;</a> -->
        </span>
      </div>
      <h1 class="project-name">Making a Reversi game with Python</h1>
      <h2 class="project-tagline">Brought to you by iBug</h2>
      <a href="https://github.com/iBug/PyReversi" class="btn">View on GitHub</a>
      <h3 class="project-date"><time datetime="2018-05-10T00:00:00+00:00" itemprop="datePublished">May 10, 2018</time> &bull; iBug</h3>
    </section>
    <section class="main-content blog-post">
      <p>As a casual attempt to accomplish a Grand Assignment, I created a Reversi game with Python. The project is open-source on GitHub and you can view it with the link above.</p>
      <p><img src="https://user-images.githubusercontent.com/7273074/39672148-558d8104-5157-11e8-9a48-040459eb8d89.png" alt="Screenshot" /></p>
      <p>The game implements the following functionality:</p>
      <ul>
        <li>Graphical User Interface (GUI), using PyQt5</li>
        <li>Built-in AI implemented as a heuristic searching (and evaluation) algorithm</li>
      </ul>
      <p>The core functionality of the game is pretty simple, and should be easy for anyone familiar with the Reverso game. The code is in <a href="https://github.com/iBug/PyReversi/blob/master/reversi.py"><code class="highlighter-rouge">reversi.py</code></a>.</p>
      <p>It’s the GUI and the AI part that differentiates implementations of the Reversi game. Since GUI isn’t very hard to create with Qt, I’ll focus on the AI algorithm here.</p>
      <p>As a general (and relatively easy) way to create an AI for the game, heuristic searching well balances between coding complexity and the competence of the resulting algorithm. Heuristic searching is basically a complete searching tree at limited depth, equipped with a heuristic evaluation function that determines the situation of the game board.</p>
      <h1 id="heuristic-evaluation">Heuristic Evaluation</h1>
      <p>From my previous experiences in playing Reversi with others, I’ve learnt that it’s important to occupy side grids and corner grids, while avoiding the opponent to occupy them. With some research and calculation, this boils down to <a href="https://github.com/iBug/PyReversi/blob/master/ai.py#L13">a predefined weight table</a>:</p>
      <div class="language-python highlighter-rouge">
        <div class="highlight">
          <pre class="highlight"><code><span class="n">SCORE</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">[</span>  <span class="mi">500</span><span class="p">,</span> <span class="o">-</span><span class="mi">150</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="o">-</span><span class="mi">150</span><span class="p">,</span>  <span class="mi">500</span><span class="p">],</span>
    <span class="p">[</span> <span class="o">-</span><span class="mi">150</span><span class="p">,</span> <span class="o">-</span><span class="mi">250</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">250</span><span class="p">,</span> <span class="o">-</span><span class="mi">150</span><span class="p">],</span>
    <span class="p">[</span>   <span class="mi">30</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span>   <span class="mi">30</span><span class="p">],</span>
    <span class="p">[</span>   <span class="mi">10</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span>   <span class="mi">30</span><span class="p">],</span>
    <span class="p">[</span>   <span class="mi">10</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span>   <span class="mi">30</span><span class="p">],</span>
    <span class="p">[</span>   <span class="mi">30</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span>   <span class="mi">30</span><span class="p">],</span>
    <span class="p">[</span> <span class="o">-</span><span class="mi">150</span><span class="p">,</span> <span class="o">-</span><span class="mi">250</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">250</span><span class="p">,</span> <span class="o">-</span><span class="mi">150</span><span class="p">],</span>
    <span class="p">[</span>  <span class="mi">500</span><span class="p">,</span> <span class="o">-</span><span class="mi">150</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="o">-</span><span class="mi">150</span><span class="p">,</span>  <span class="mi">500</span><span class="p">]</span>
<span class="p">]</span>
</code></pre>
        </div>
      </div>
      <p>This is a good start but may not be sufficient in complicated scenarios. While it’s good to try to occupy sides and corners, it’d be of little value when they’re easily captured by the opponent.</p>
      <p>Given the idea above, I came up with this “chess liberty” solution. The score will be decreased if a chess is “too liberated”.</p>
      <div class="language-python highlighter-rouge">
        <div class="highlight">
          <pre class="highlight"><code><span class="k">for</span> <span class="n">dx</span> <span class="ow">in</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]:</span>
    <span class="k">for</span> <span class="n">dy</span> <span class="ow">in</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]:</span>
        <span class="n">tx</span><span class="p">,</span> <span class="n">ty</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">dx</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">dy</span>
        <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">tx</span> <span class="o">&lt;</span> <span class="n">BS</span> <span class="ow">and</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">ty</span> <span class="o">&lt;</span> <span class="n">BS</span> <span class="ow">and</span> <span class="n">board</span><span class="p">[</span><span class="n">tx</span><span class="p">][</span><span class="n">ty</span><span class="p">]</span> <span class="o">==</span> <span class="n">EMPTY</span><span class="p">:</span>
            <span class="n">liberty</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="k">if</span> <span class="n">chess</span> <span class="o">==</span> <span class="n">BLACK</span><span class="p">:</span>
    <span class="n">c1</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">s1</span> <span class="o">+=</span> <span class="n">SCORE</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="n">y</span><span class="p">]</span> <span class="o">-</span> <span class="n">liberty</span> <span class="o">*</span> <span class="n">LIBERTY</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">c2</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">s2</span> <span class="o">+=</span> <span class="n">SCORE</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="n">y</span><span class="p">]</span> <span class="o">-</span> <span class="n">liberty</span> <span class="o">*</span> <span class="n">LIBERTY</span>
</code></pre>
        </div>
      </div>
      <p>where <code class="highlighter-rouge">s1</code> is the score for the black side, and <code class="highlighter-rouge">s2</code> is the score for the white side.</p>
      <p>The final part is the side chess check (<a href="https://github.com/iBug/PyReversi/blob/master/ai.py#L110">code</a>). It checks if a corner may be occupied by the opponent (having own chess around), and if it’s occupied, add additional score if there are more chesses of the same color.</p>
      <h1 id="searching-tree">Searching tree</h1>
      <p>A plain searching algorithm would be really plain. The black side wants the score to be as high as possible, while the white side wants the exact opposite.</p>
      <p>A pseudo-code of the algorithm is given below:</p>
      <div class="language-javascript highlighter-rouge">
        <div class="highlight">
          <pre class="highlight"><code><span class="nx">MAX</span> <span class="o">=</span> <span class="mi">999999</span>

<span class="kd">function</span> <span class="nx">heuristicSearch</span><span class="p">(</span><span class="nx">game</span><span class="p">,</span> <span class="nx">side</span><span class="p">,</span> <span class="nx">depth</span><span class="p">)</span>
  <span class="k">if</span> <span class="nx">depth</span> <span class="o">&lt;=</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="kc">null</span><span class="p">,</span> <span class="nx">heuristicScore</span><span class="p">(</span><span class="nx">game</span><span class="p">)</span>

  <span class="nx">want_max</span> <span class="o">=</span> <span class="p">(</span><span class="nx">side</span> <span class="o">==</span> <span class="nx">BLACK</span><span class="p">)</span>
  <span class="nx">bestMove</span> <span class="o">=</span> <span class="kc">null</span>
  <span class="k">if</span> <span class="nx">want_max</span>
    <span class="nx">bestScore</span> <span class="o">=</span> <span class="o">-</span><span class="nx">MAX</span> <span class="o">-</span> <span class="mi">1</span>
  <span class="k">else</span>
    <span class="nx">bestScore</span> <span class="o">=</span> <span class="o">+</span><span class="nx">MAX</span> <span class="o">+</span> <span class="mi">1</span>

  <span class="k">for</span> <span class="nx">move</span> <span class="k">in</span> <span class="nx">game</span><span class="p">.</span><span class="nx">availableMoves</span>
    <span class="nx">game</span><span class="p">.</span><span class="nx">perform</span> <span class="nx">move</span>
    <span class="c1">// Recurse</span>
    <span class="nx">subMove</span><span class="p">,</span> <span class="nx">subScore</span> <span class="o">=</span> <span class="nx">heuristicSearch</span><span class="p">(</span><span class="nx">game</span><span class="p">,</span> <span class="nx">side</span><span class="p">,</span> <span class="nx">depth</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="nx">game</span><span class="p">.</span><span class="nx">undo</span>

    <span class="k">if</span> <span class="nx">want_max</span>
      <span class="k">if</span> <span class="nx">subScore</span> <span class="o">&gt;</span> <span class="nx">bestScore</span>
        <span class="nx">bestScore</span> <span class="o">=</span> <span class="nx">subScore</span>
        <span class="nx">bestMove</span> <span class="o">=</span> <span class="nx">move</span>
    <span class="k">else</span>
      <span class="k">if</span> <span class="nx">subScore</span> <span class="o">&lt;</span> <span class="nx">bestScore</span>
        <span class="nx">bestScore</span> <span class="o">=</span> <span class="nx">subScore</span>
        <span class="nx">bestMove</span> <span class="o">=</span> <span class="nx">move</span>
  <span class="k">return</span> <span class="nx">bestMove</span><span class="p">,</span> <span class="nx">bestScore</span>
</code></pre>
        </div>
      </div>
      <p>That’s the abstract of the searching procedure. There are a few things to do before it’s fully working.</p>
      <ul>
        <li>Handle the case where the game has ended already</li>
        <li>Handle the case where the current player has no moves available</li>
      </ul>
      <p>Both cases aren’t too complex to be handled with a few lines of codes. And then, there’s a performance concern: Why bother searching deeper when one move is bad enough that subsequent moves can’t perform any better?</p>
      <p>Fortunately, with the help of <a href="https://en.wikipedia.org/wiki/Alpha–beta_pruning">the Alpha-Beta Pruning algorithm</a>, this is a solvable problem, which I will describe in a later article.</p>
      <span class="post-tags">
        <b>Tag: </b>
        <a href="/tags/development" class="tag">development</a>
      </span>
      <footer class="site-footer">
        <span class="site-footer-credits">
          <div>
            <span style="float:left;padding-left:10px;height:0px;">
              <a href="/blog/2018/04/build-github-pages-with-travis-ci.html">&laquo; Previous</a>
            </span>
            <span style="float:right;padding-right:10px;height:0px;">
              Next &raquo;
            </span>
          </div>
          <div align="center">
            <p><a href="/blog"><b>Return to index</b></a></p>
            <p>Link to this article: <a href="https://ibug.github.io/p/6">https://ibug.github.io/p/6</a></p>
            <p><small>Content licensed under the <a href="https://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0 license</a>. Attribution required.</small></p>
          </div>
        </span>
      </footer>
    </section>
    <script type="text/javascript">
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      
      ga('create', 'UA-115907213-1', 'auto');
      ga('send', 'pageview');
    </script>
  </body>
</html>