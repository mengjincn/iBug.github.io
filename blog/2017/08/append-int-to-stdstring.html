<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="UTF-8">
    <!-- _layout: post -->
    <!-- Begin Jekyll SEO tag v2.5.0 -->
    <title>Append int to std::string | iBug @ GitHub</title>
    <meta name="generator" content="Jekyll v3.7.4" />
    <meta property="og:title" content="Append int to std::string" />
    <meta name="author" content="iBug" />
    <meta property="og:locale" content="en_US" />
    <meta name="description" content="Some confusion about templates in C++" />
    <meta property="og:description" content="Some confusion about templates in C++" />
    <link rel="canonical" href="https://ibug.github.io/blog/2017/08/append-int-to-stdstring.html" />
    <meta property="og:url" content="https://ibug.github.io/blog/2017/08/append-int-to-stdstring.html" />
    <meta property="og:site_name" content="iBug @ GitHub" />
    <meta property="og:type" content="article" />
    <meta property="article:published_time" content="2017-08-04T11:35:05+00:00" />
    <script type="application/ld+json">
      {"description":"Some confusion about templates in C++","@type":"BlogPosting","url":"https://ibug.github.io/blog/2017/08/append-int-to-stdstring.html","headline":"Append int to std::string","dateModified":"2017-08-04T11:35:05+00:00","datePublished":"2017-08-04T11:35:05+00:00","author":{"@type":"Person","name":"iBug"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://ibug.github.io/blog/2017/08/append-int-to-stdstring.html"},"@context":"http://schema.org"}
    </script>
    <!-- End Jekyll SEO tag -->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#159A34">
    <!-- https://fonts.googleapis.com/css?family=Open+Sans:400,700 -->
    <link href='/assets/css/OpenSans.css' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="/assets/css/style.css?v=d50b16f8a84430ce79b2988440c7392a7062a22d">
    <link rel="shortcut icon" type="image/png" href="/assets/favicon.png">
    <time class="dt-published" datetime="2017-08-04T11:35:05+00:00" itemprop="datePublished">
      <script type="text/javascript" src="/assets/js/love.js" ></script>
    </head>
    <body>
      <section class="page-header">
        <div class="page-header-nav">
          <span style="float:left;height:0px;">
            <a href="/blog/2017/06/android-phone-cores.html" class="btn-inline">&laquo; Previous</a>
          </span>
          <span style="float:right;height:0px;">
            <a href="/blog/2018/03/joining-smokedetector.html" class="btn-inline">Next &raquo;</a>
          </span>
        </div>
        <h1 class="project-name">Append int to std::string</h1>
        <h2 class="project-tagline">A Stack Overflow question & answer</h2>
        <a href="https://stackoverflow.com/a/45505795/5958455" class="btn">View on Stack Overflow</a>
        <h3 class="project-date"><time datetime="2017-08-04T11:35:05+00:00" itemprop="datePublished">Aug 4, 2017</time> &bull; iBug</h3>
      </section>
      <section class="main-content blog-post">
        <article>
          <p>For people new to template resolution and template type deduction in C++, they may have written this code and get confused why it doesn’t compile:</p>
          <div class="language-c++ highlighter-rouge">
            <div class="highlight">
              <pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre>
            </td>
            <td class="rouge-code">
              <pre><span class="cp">#include &lt;string&gt;
</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">s</span><span class="p">;</span>
    <span class="n">s</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">;</span>     <span class="c1">// compiles correctly
</span>    <span class="n">s</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="mi">2</span><span class="p">;</span>  <span class="c1">// compiler error
</span>    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre>
            </td>
          </tr>
        </tbody>
      </table>
    </code></pre>
</div>
</div>
<p>And here’s my answer:</p>
<hr />
<p><strong>TL;DR</strong> <code class="highlighter-rouge">operator+=()</code> is a class member function in class <code class="highlighter-rouge">string</code>, while <code class="highlighter-rouge">operator+()</code> is a template function.</p>
<p>The standard class <code class="highlighter-rouge">template&lt;typename CharT&gt; basic_string&lt;CharT&gt;</code> has an overloaded member function <code class="highlighter-rouge">basic_string&amp; operator+=(CharT)</code>, and string is just <code class="highlighter-rouge">basic_string&lt;char&gt;</code>.</p>
<p>As values that fits in a shorter type can be interpreted as that type, in the expression <code class="highlighter-rouge">s += 2</code>, the 2 is <em>not</em> treated as <code class="highlighter-rouge">int</code>, but <code class="highlighter-rouge">char</code> instead. It has <em>exactly</em> the same effect as <code class="highlighter-rouge">s += '\x02'</code>. A char with ASCII code 2 (STX) is appended, instead of the character <code class="highlighter-rouge">'2'</code> (with ASCII value 50, or 0x32).</p>
<p>However, string does not have an overloaded member function like <code class="highlighter-rouge">string operator+(int)</code>, so <code class="highlighter-rouge">s + 2</code> is not a valid expression, thus throws an error during compilation. (More below)</p>
<p>You can use operator+ function in string in these ways:</p>
<div class="language-c++ highlighter-rouge">
  <div class="highlight">
    <pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre>
  </td>
  <td class="rouge-code">
    <pre><span class="n">s</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="kt">char</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>  <span class="c1">// or (char)2
</span><span class="n">s</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="n">std</span><span class="o">::</span><span class="n">to_string</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>  <span class="c1">// C++11 and above only
</span></pre>
  </td>
</tr>
</tbody>
</table>
</code></pre>
</div>
</div>
<hr />
<p>For people concerned about why 2 isn’t automatically cast to <code class="highlighter-rouge">char</code> with <code class="highlighter-rouge">operator+</code>,</p>
<div class="language-c++ highlighter-rouge">
  <div class="highlight">
    <pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre>
  </td>
  <td class="rouge-code">
    <pre><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">CharT</span><span class="o">&gt;</span>
  <span class="n">basic_string</span><span class="o">&lt;</span><span class="n">CharT</span><span class="o">&gt;</span>
  <span class="k">operator</span><span class="o">+</span><span class="p">(</span><span class="k">const</span> <span class="n">basic_string</span><span class="o">&lt;</span><span class="n">CharT</span><span class="o">&gt;&amp;</span> <span class="n">lhs</span><span class="p">,</span> <span class="n">CharT</span> <span class="n">rhs</span><span class="p">);</span>
</pre>
  </td>
</tr>
</tbody>
</table>
</code></pre>
</div>
</div>
<p>The above is the prototype<sup>[note]</sup> for the plus operator in <code class="highlighter-rouge">s + 2</code>, and because it’s a template function, it is requiring an implementation of both <code class="highlighter-rouge">operator+&lt;char&gt;</code> and <code class="highlighter-rouge">operator+&lt;int&gt;</code>, which is conflicting. For details, see <a href="https://stackoverflow.com/q/45506372/5958455">Why isn’t automatic downcasting applied to template functions?</a></p>
<p>Meanwhile, the prototype of <code class="highlighter-rouge">operator+=</code> is:</p>
<div class="language-c++ highlighter-rouge">
  <div class="highlight">
    <pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre>
  </td>
  <td class="rouge-code">
    <pre><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">CharT</span><span class="o">&gt;</span>
<span class="k">class</span> <span class="nc">basic_string</span><span class="p">{</span>
    <span class="n">basic_string</span><span class="o">&amp;</span>
      <span class="k">operator</span><span class="o">+=</span><span class="p">(</span><span class="n">CharT</span> <span class="n">_c</span><span class="p">);</span>
<span class="p">};</span>
</pre>
  </td>
</tr>
</tbody>
</table>
</code></pre>
</div>
</div>
<p>You see, no template here (it’s a class member function), so the compiler deduces that type <code class="highlighter-rouge">CharT</code> is <code class="highlighter-rouge">char</code> from class implementation, and <code class="highlighter-rouge">int(2)</code> is automatically cast into <code class="highlighter-rouge">char(2)</code>.</p>
<hr />
<p><sup><b>Note:</b> Unnecessary code is stripped when copying from C++ standard include source. That includes typename 2 and 3 (Traits and Allocator) for template class “basic_string”, and unnecessary underscores, in order to improve readability.</sup></p>
</article>
<span class="post-tags">
  <b>Tags: </b>
  <a href="/tags/stack-overflow" class="tag">stack-overflow</a>
  <a href="/tags/development" class="tag">development</a>
</span>
<footer class="site-footer">
  <span class="site-footer-credits">
    <div>
      <span style="float:left;padding-left:10px;height:0px;">
        <a href="/blog/2017/06/android-phone-cores.html">&laquo; Previous</a>
      </span>
      <span style="float:right;padding-right:10px;height:0px;">
        <a href="/blog/2018/03/joining-smokedetector.html">Next &raquo;</a>
      </span>
    </div>
    <div align="center">
      <p><a href="/blog"><b>Return to index</b></a></p>
      <p>Link to this article: <a href="https://ibug.github.io/p/1">https://ibug.github.io/p/1</a></p>
      <p><small>Content licensed under the <a href="https://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0 license</a>. Attribution required.</small></p>
    </div>
  </span>
</footer>
</section>
<script type="text/javascript" src="/assets/js/line.js" ></script>
<script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  		m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  
  ga('create', 'UA-115907213-1', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>